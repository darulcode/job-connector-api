stages:
  - build
  - test
  - deploy

# Tahap Build
build:
  stage: build
  image: maven:latest
  script:
    - mvn clean package -DskipTests
  artifacts:
    paths:
      - target/jobConnector-0.0.1-SNAPSHOT.jar

# Tahap Test
test:
  stage: test
  image: maven:latest
  script:
    - mvn test

# Tahap Deploy
deploy:
  stage: deploy
  image: alpine:latest
  before_script:
    - apk add --no-cache openssh
    - mkdir -p ~/.ssh
    - echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCmT91lbN4j1S5lM3czhsFEzMt1pWfEwJu3O3PVLp3ZctYrAhFWlDXYXCy1KNEDzp9mjXj/pGS/Qz523Cgabeu39NWkr/lVFI8uMOwD4T4eAFWxFYfuxNY4KT8f2D9iU8Fc5wExPpuIy+TqtGCOAlURAYWOcOqpPJ/fU/EaBSg3iphFirLL9DaeEG7aw3lANBbQmUULz3pSZeBFpsDm+aTbnF7Zsv8dAXQZAc4XAwIIG6kLoqxTivtXUR9n8SFUU68GTyQ6mbQElRi2okT9km0BnVSvKJxE0h5zuC87HaAckYqh5DxOjH4ssAfwHD7bYCITS7l0TjMoL8L13YQ+xK3OJdpm+zkGhEKlLJP3Dq9sBcVPFGtvsKdgs5rxmviL3WoDURPiuPj2EO5ywrIxscXw5JWNO2IeGAJtzYvC/ZvK59l+0lsNzUcAzG9dyz6c2gqPv4EZIHaVNU6ph4W/iJekGG7qQQkbkl8s1klXH7Toci4RaDXrsaRDgxHixZhOC/k= enigma@enigma-Latitude-3310" > ~/.ssh/id_rsa
    - chmod 600 ~/.ssh/id_rsa
    - echo "|1|kUbAuw+NKlH/1VKlRHHqrZjxuYo=|IZLFlYyw9sh68dALgBsybQl94gE= ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKc6+Gsq/sCnXVdXnFyfjjpSo82AC6aK0NcrfXPaQ8oD
      |1|z6602kDgiVnfOAduO96iLE9M0dM=|MBMG6UGu5jL6a1Yqjg6c6WVWzto= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOG1j3TRYaRinUDuxNuGFY8wVmW9WmvSNtm8HJvHQ1BgKihJZUvevYiw27VrYRJsrYX2j33gq6JNcN5U1W0VyLQ=
      |1|DobGl/oLkkcgtab9ojGtFq8JaTM=|z8b+oXWcaoPRGkzh1aBJN9oZriE= ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAfuCHKVTjquxvt6CM6tdG4SLp1Btn/nOeHHE5UOzRdf
      |1|5WWiqCmBP7HQBjrXiOrsAzrybiw=|dEEl7DlcQOea09uMtmk1+/fyYcQ= ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIInWNkAY3z/B759gvqTeDSlo5qxWbSyMOiFPjlsmeN0k
      |1|8Lu375Mus9eH7AyIO9EYWdPLeZg=|7mrq2dcH81vhcUGs0qfJvZ1HEgs= ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCqfUOVIzpDH87oKS6FhkwuZ6xv7S1f7XsVqU2cDt1rLXF9ZKFyzj5bsDOyHkzJBbmC5Rz3ZhkStlPIrUl53sfeOuGmfyLnETKrdPgTC1JDXBiE1pVoQ7D8w3yWt2Fl0q3C9NHjQoSHZ2g7Jsrqob+p5t/5oeCJO884ugN3OO9N2UV2VRhaj6+5MyzbsiYg05NxEc1AoxXTVXh1OHJF/7ikbNjQAPG0erSL9dIptw/gQGT6AGgn/S5v+1bADmaLtoriq8yWVs4fTJ2YUC3fNB82duZrfYzU62ZGZV90dkVzyvuII1qiGlx9LlDQiPZTnnxbw5KVGyV9VMiO6BBNt4NEZq8/zZgg1ujcwiOUyHZ5TF7/+4I0H8G/z/ul3nOUMZ0MvDSo/GllzTxwl5sdrRErLuPNjkj8Gz6aulIYFfKLXcKWKXTnMOEw9CM0ExhcC8an/YFmszuJzdkXrLm5k+TauZJIUai0VtMk1Gcr89ZG1TBMGOqfphh4uHA9dclvYz0=
      |1|W1os1qTzuLKqG/C8rGibddUodh4=|gqxqn/AzmjKXIG17keQZpewhBwI= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBIixlZxT2gvxObhg4L92BJcx4w+T20EQo7Pio2znY7as+EtK69Mq3yOUp7Jjo/etWuJZNxwrgBlf1TnvBQ6Q2IY=
      |1|cGLkYJNVMJPjMLw6RA+k/sNoLPY=|Sn4gezpOcglkOsao6aL7+ZqLip8= ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMqqnkVzrm0SdG6UOoqKLsabgH5C9okWi0dh2l9GKJl
      |1|r1OJbtQhWse42IhjjXgGLvDMEAk=|EMrjWEigBPG+EXfnoCKlynm2s7M= ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCj7ndNxQowgcQnjshcLrqPEiiphnt+VTTvDP6mHBL9j1aNUkY4Ue1gvwnGLVlOhGeYrnZaMgRK6+PKCUXaDbC7qtbW8gIkhL7aGCsOr/C56SJMy/BCZfxd1nWzAOxSDPgVsmerOBYfNqltV9/hWCqBywINIR+5dIg6JTJ72pcEpEjcYgXkE2YEFXV1JHnsKgbLWNlhScqb2UmyRkQyytRLtL+38TGxkxCflmO+5Z8CSSNY7GidjMIZ7Q4zMjA2n1nGrlTDkzwDCsw+wqFPGQA179cnfGWOWRVruj16z6XyvxvjJwbz0wQZ75XK5tKSb7FNyeIEs4TT4jk+S4dhPeAUC5y+bDYirYgM4GC7uEnztnZyaVWQ7B381AK4Qdrwt51ZqExKbQpTUNn+EjqoTwvqNj4kqx5QUCI0ThS/YkOxJCXmPUWZbhjpCg56i+2aB6CmK2JGhn57K5mj0MNdBXA4/WnwH6XoPWJzK5Nyu2zB3nAZp+S5hpQs+p1vN1/wsjk=
      |1|mZwwAIYOMh+at7dbisbCXNAr1rE=|t/Sf3WsBJbZzuCvnRIEKPgA2New= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg=
      |1|NSQ3l35BEwKJz+bTDB3NsPMeESY=|kJPgYU0uCEMghwJJkDRnMbDHo2o= ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGOxxbXeOHHuGD2+VU9rRVcaL3HYQV8BbXn45abmzAhJ
      |1|VU+h4eVkKOAErkBM+pe/n4aJFng=|ItjDvF8wDhDDCTBdJZGJDJr34bE= ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDEw2YjJVc+XacmyDdOakhey+zFa5ACCNsK2c3nrSOJ1B7EMsMwyI0xViueTFfzOKeBJFvmbr9og+eUEcWOF3nExg5xHRmr2yjhA3A41j4KHwxA4euRqe/Yakb5xBMMdK/JEwdBBVw7iqFnGL+7m9mirx3+PgVbuxr1Tgh/qnPCFRrL4sMqBX7koMrdQQUPpDr14LJyVtTENt7JWgj+mTJ+pTYW4KIGMhcf5sI0U8tsPxAsCJ9wUxGLgbeAXrgqQ0wX2dQFzLW1tczdYbA/VS2/jLncIvSC+hdu2Hvo7F9EhJ8f62I8C9Fuy0e+CjLyGW1ZpoJ+SHLNo+fac6E8o+WUw4RjaKL48veKvXPcBzx6c6ZNMSshVojJR3ggsBqI9nj6PovCGACu5ArXFTfM4bUUGJNxzS5aPJQWa973/uzKGNCj2AuFz9FAs6Zex+XI0UkVbkMPDH0bhD3H/uCYTFADohKOaMJog+lOEoAuIefjRt6IZ8z25kpm22Ee3/K8ulE=
      |1|eDg5DUgPFVCQQNw1J7HsQXJEd1M=|522PHCi62cbMBzTRi222M+gOsug= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCqr/40eBwGAtuV/nVgc51YCiMR6jsP6c0I5aoGQoHJS/X45LzPytHw9LmIGOQi6enxkD6/y+URwRYn9n32CCok=
      " > ~/.ssh/known_hosts
  script:
    - scp target/jobConnector-0.0.1-SNAPSHOT.jar user@your-server:/path/to/deploy
    - ssh user@your-server "docker-compose -f /path/to/deploy/docker-compose.yml up -d"
  only:
    - master
