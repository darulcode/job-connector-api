stages:
  - build
  - test
  - deploy

before_script:
  - mkdir -p ~/.ssh
  - echo "$SSH_PRIVATE_KEY" > ~/.ssh/id_rsa
  - chmod 600 ~/.ssh/id_rsa
  - echo "$SSH_KNOWN_HOSTS" > ~/.ssh/known_hosts

build:
  stage: build
  script:
    - git clone git@git.enigmacamp.com:enigma-camp/offline-class-pascal/pascal-18/final-project/team-1-enigma-job-connector/backend/enigma-job-connector-api.git
    - cd enigma-job-connector-api
    - mvn clean install

test:
  stage: test
  script:
    - mvn test

deploy:
  stage: deploy
  script:
    - docker build -t job-connector-api .
    - docker-compose up -d
