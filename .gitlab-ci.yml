stages:
  - deploy

variables:
  VPS_SSH_PRIVATE_KEY: $SSH_PRIVATE_KEY
  SERVER_IP: "152.42.224.141"
  SERVER_USER: "root"

deploy:
  stage: deploy
  tags:
    - cq
  script:
    - echo "Pulling latest changes from origin master..."
    - ssh -i <(echo "$VPS_SSH_PRIVATE_KEY") $SERVER_USER@$SERVER_IP << 'EOF'
      cd enigma-job-connector-api
      git pull origin master
      docker compose up -d
      EOF
  only:
    - master
